<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
	<meta charset="utf-8"/>
	<title>Danh sách user</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<!-- App favicon -->
	<link rel="shortcut icon" th:href="@{/assets_admin/images/favicon.ico}">

	<!-- third party css -->
	<link th:href="@{/assets/assets_admin/libs/datatables/dataTables.bootstrap4.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/assets_admin/libs/datatables/buttons.bootstrap4.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/assets_admin/libs/datatables/responsive.bootstrap4.css}" rel="stylesheet" type="text/css"/>

	<!-- App css -->
	<link rel="shortcut icon" th:href="@{/assets/assets_admin/images/favicon.ico}">

	<!-- App css -->
	<link th:href="@{/assets/assets_admin/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/assets_admin/css/icons.min.css}" rel="stylesheet" type="text/css"/>
	<link th:href="@{/assets/assets_admin/css/app.min.css}" rel="stylesheet" type="text/css"/>

</head>

<body>

<!-- Begin page -->
<div id="wrapper">


	<!-- Topbar Start -->
	<div class="navbar-custom">
		<ul class="list-unstyled topnav-menu float-right mb-0">

			<li class="dropdown d-none d-lg-block">
				<a class="nav-link dropdown-toggle mr-0 waves-effect waves-light" data-toggle="dropdown" href="#"
				   role="button" aria-haspopup="false" aria-expanded="false">
					<img th:src="@{/assets_admin/images/flags/vietnam.jpg}" alt="user-image" class="mr-1" height="12">
					<span
						class="align-middle">Vietnam <i class="mdi mdi-chevron-down"></i> </span>
				</a>
				<div class="dropdown-menu dropdown-menu-right">
					<!-- item-->
					<a href="javascript:void(0);" class="dropdown-item notify-item">
						<img th:src="@{/assets_admin/images/flags/us.jpg}" alt="user-image" class="mr-1"
						     height="12"> <span
						class="align-middle">English</span>
					</a>
				</div>
			</li>


			<li class="dropdown notification-list">
				<a class="nav-link dropdown-toggle  waves-effect waves-light" data-toggle="dropdown" href="#"
				   role="button" aria-haspopup="false" aria-expanded="false">
					<i class="fe-bell noti-icon"></i>
					<span class="badge badge-danger rounded-circle noti-icon-badge">9</span>
				</a>
				<div class="dropdown-menu dropdown-menu-right dropdown-lg">

					<!-- item-->
					<div class="dropdown-item noti-title">
						<h5 class="m-0">
                                    <span class="float-right">
                                        <a href="" class="text-dark">
                                            <small>Xoá hết</small>
                                        </a>
                                    </span>Thông báo
						</h5>
					</div>

					<div class="slimscroll noti-scroll">

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-success"><i class="mdi mdi-comment-account-outline"></i></div>
							<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">1 min
								ago</small></p>
						</a>

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-info"><i class="mdi mdi-account-plus"></i></div>
							<p class="notify-details">New user registered.<small class="text-muted">5 hours ago</small>
							</p>
						</a>

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-danger"><i class="mdi mdi-heart"></i></div>
							<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">3 days
								ago</small></p>
						</a>

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-warning"><i class="mdi mdi-comment-account-outline"></i></div>
							<p class="notify-details">Caleb Flakelar commented on Admin<small class="text-muted">4 days
								ago</small></p>
						</a>

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-purple"><i class="mdi mdi-account-plus"></i></div>
							<p class="notify-details">New user registered.<small class="text-muted">7 days ago</small>
							</p>
						</a>

						<!-- item-->
						<a href="javascript:void(0);" class="dropdown-item notify-item">
							<div class="notify-icon bg-primary"><i class="mdi mdi-heart"></i></div>
							<p class="notify-details">Carlos Crouch liked <b>Admin</b><small class="text-muted">13 days
								ago</small></p>
						</a>

					</div>

					<!-- All-->
					<a href="javascript:void(0);" class="dropdown-item text-center text-primary notify-item notify-all">
						View all
						<i class="fi-arrow-right"></i>
					</a>

				</div>
			</li>

			<li class="dropdown notification-list">
				<a class="nav-link dropdown-toggle nav-user mr-0 waves-effect waves-light" data-toggle="dropdown"
				   href="#" role="button" aria-haspopup="false" aria-expanded="false">
					<span class="ml-1"> <i class="mdi mdi-chevron-down"></i> </span>
				</a>
				<div class="dropdown-menu dropdown-menu-right profile-dropdown ">
					<!-- item-->
					<div class="dropdown-header noti-title">
						<h6 class="text-overflow m-0">Chào mừng!</h6>
					</div>

					<!-- item-->
					<a th:href="@{/admin/profile}" class="dropdown-item notify-item">
						<i class="fe-user"></i>
						<span>Thông tin cá nhân</span>
					</a>

					<!-- item-->
					<a th:href="@{/logout}" class="dropdown-item notify-item">
						<i class="fe-log-out"></i>
						<span>Logout</span>
					</a>

				</div>
			</li>

			<li class="dropdown notification-list">
				<a href="javascript:void(0);" class="nav-link right-bar-toggle waves-effect waves-light">
					<i class="fe-settings noti-icon"></i>
				</a>
			</li>


		</ul>

		<!-- LOGO -->
		<div class="logo-box">
			<a th:href="@{/admin/home}" class="logo text-center">
                        <span class="logo-lg">
                            <img th:src="@{/assets_admin/images/logo-light.png}" alt="" height="16">
	                        <!-- <span class="logo-lg-text-light">UBold</span> -->
                        </span>
				<span class="logo-sm">
                            <!-- <span class="logo-sm-text-dark">U</span> -->
                            <img th:src="@{/assets_admin/images/logo-sm.png}" alt="" height="24">
                        </span>
			</a>
		</div>

		<ul class="list-unstyled topnav-menu topnav-menu-left m-0">
			<li>
				<button class="button-menu-mobile waves-effect waves-light">
					<i class="fe-menu"></i>
				</button>
			</li>

			<li class="d-none d-sm-block">
				<form class="app-search">
					<div class="app-search-box">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search...">
							<div class="input-group-append">
								<button class="btn" type="submit">
									<i class="fe-search"></i>
								</button>
							</div>
						</div>
					</div>
				</form>
			</li>

		</ul>
	</div>
	<!-- end Topbar -->


	<!-- ========== Left Sidebar Start ========== -->
	<div class="left-side-menu">

		<div class="slimscroll-menu">

			<!--- Sidemenu -->
			<div id="sidebar-menu">

				<ul class="metismenu" id="side-menu">

					<li class="menu-title">QUẢN LÝ</li>

					<li>
						<a th:href="@{/admin/home}">
							<i class="fe-airplay"></i>
							<span> Dashboard </span>
						</a>
					</li>
					<li>
						<a th:href="@{/admin/user}">
							<i class="fe-bar-chart-2"></i>
							Quản lý user
						</a>
					</li>
					<li>
						<a th:href="@{/film/list}">
							<i class="fe-briefcase"></i>
							Quản lý film
						</a>

					</li>
					<li>
						<a th:href="@{/listCategory}">
							<i class="fe-disc"></i>
							Quản lý loại film
						</a>
					</li>

					<li>
						<a th:href="@{/admin/country}">
							<i class="fe-disc"></i>
							Quản lý quốc gia
						</a>
					</li>
					<li>
						<a th:href="@{/admin/banner}">
							<i class="fe-disc"></i>
							Quản lý Banner
						</a>
					</li>
					<li>
						<a th:href="@{/comments}">
							<i class="fe-disc"></i>
							Quản lý bình luận
						</a>
					</li>
				</ul>

			</div>
			<!-- End Sidebar -->

			<div class="clearfix"></div>

		</div>
		<!-- Sidebar -left -->

	</div>
	<!-- Left Sidebar End -->

	<!-- ============================================================== -->
	<!-- Start Page Content here -->
	<!-- ============================================================== -->

	<div class="content-page">
		<div class="content">

			<!-- Start Content-->
			<div class="container-fluid">
				<div class="row">
					<div class="col-12">
						<div class="card-box table-responsive">
							<div class="form-row">
								<div class="col-md-4 mb-3">
									<label for="email">Email:</label>
									<input type="text" class="form-control" name="email" id="email">
								</div>

								<div class="col-md-4 mb-3">
									<label for="phone">Số điện thoại:</label>
									<input type="text" class="form-control" name="phone" id="phone">
								</div>

								<div class="col-md-4 mb-3">
									<label for="username">Username:</label>
									<input type="text" class="form-control" name="username" id="username">
								</div>

								<button id="btnSearch" onclick="searchCondition(0,3)" class="btn btn-primary">Tìm
									kiếm
								</button>
							</div>
							<table id="datatable-buttons"
							       class="table table-striped table-bordered dt-responsive nowrap"
							       style="border-collapse: collapse; border-spacing: 0; width: 100%;">
								<thead>
								<tr>
									<th>ID</th>
									<th>Username</th>
									<th>Email</th>
									<th>Số điện thoại</th>
									<th>Ngày tạo</th>
									<th>Trạng thái</th>
									<th>Vai trò</th>
								</tr>
								</thead>
								<tbody id="contentTable">
								</tbody>
							</table>

							<nav aria-label="...">
								<ul class="pagination" id="pageId" style="float: right;">
								</ul>
							</nav>
						</div>
					</div>
				</div>
				<!-- end row -->
			</div> <!-- end container-fluid -->

		</div> <!-- end content -->


		<!-- Footer Start -->
		<footer class="footer">
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-12">
						2017 - 2019 &copy; Abstack theme by <a href="">Coderthemes</a>
					</div>

				</div>
			</div>
		</footer>
		<!-- end Footer -->

	</div>

	<!-- ============================================================== -->
	<!-- End Page content -->
	<!-- ============================================================== -->

</div>
<!-- END wrapper -->

<!-- Vendor js -->
<script th:src="@{/assets/assets_admin/js/vendor.min.js}"></script>

<!-- Required datatable js -->
<script th:src="@{/assets/assets_admin/libs/datatables/jquery.dataTables.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/datatables/dataTables.bootstrap4.min.js}"></script>
<!-- Buttons examples -->
<script th:src="@{/assets/assets_admin/libs/datatables/dataTables.buttons.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/datatables/buttons.bootstrap4.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/jszip/jszip.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/pdfmake/pdfmake.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/pdfmake/vfs_fonts.js}"></script>
<script th:src="@{/assets/assets_admin/libs/datatables/buttons.html5.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/datatables/buttons.print.min.js}"></script>

<!-- Responsive examples -->
<script th:src="@{/assets/assets_admin/libs/datatables/dataTables.responsive.min.js}"></script>
<script th:src="@{/assets/assets_admin/libs/datatables/responsive.bootstrap4.min.js}"></script>

<!-- Datatables init -->
<script th:src="@{/assets/assets_admin/js/pages/datatables.init.js}"></script>

<!-- App js -->
<script th:src="@{/assets/assets_admin/js/app.min.js}"></script>
<script>
    function initData(page, size, filter) {
        $.ajax({
            type: "POST",
            url: `http://localhost:8080/userList?page=${page}&size=${size}`,
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(filter),
            success: function (response) {
                console.log("OK")
                console.log(response);
                displayContentAndPagination(response);
            },
            error: function (error) {
                console.log("error")
                console.log(error);
            }
        });
    }

    function displayContentAndPagination(data) {
        let contentTable = $('#contentTable');
        contentTable.empty();
        let contents = data.data.content;
        console.log(data.data)

        // Display data in the table
        for (let i = 0; i < contents.length; i++) {
            let user = contents[i];
            let row = '<tr>' +
                '<td>' + user.userId + '</td>' +
                '<td style="width: 15%;">' + user.userName + '</td>' +
                '<td style="width: 15%;">' + user.email + '</td>' +
                '<td style="width: 15%;">' + user.phone + '</td>' +
                '<td style="width: 15%;">' + user.createdAt + '</td>' +
                '<td>' +
                '<select id="statusSelect-' + user.userId + '" class="status-select" data-user-id="' + user.userId + '">' +
                '<option value="true" ' + (user.status === true ? 'selected' : '') + '>ACTIVE</option>' +
                '<option value="false" ' + (user.status === false ? 'selected' : '') + '>INACTIVE</option>' +
                '</select>' +
                '</td>' +
                '<td>' +
                '<select id="roleSelect-' + user.userId + '" class="role-select" data-user-id="' + user.userId + '">' +
                '<option value="ADMIN" ' + (user.role === 'ADMIN' ? 'selected' : '') + '>ADMIN</option>' +
                '<option value="FREE" ' + (user.role === 'FREE' ? 'selected' : '') + '>FREE</option>' +
                '<option value="PAID" ' + (user.role === 'PAID' ? 'selected' : '') + '>PAID</option>' +
                '</select>' +
                '</td>' +
                '</tr>';
            contentTable.append(row);
        }

        // Pagination
        let totalElements = data.data.totalElements;
        let pageSize = data.data.pageSize;
        let currentPage = data.data.pageNumber;

        let pageId = $("#pageId");
        pageId.empty();
        let pages = '';

        if (currentPage > 0) {
            pages += '<li class="page-item"><a class="page-link" onclick="changePage(' + (currentPage - 1) + ',' + pageSize + ',event)" href="#">Previous</a></li>';
        } else {
            pages += '<li class="page-item disabled"><span class="page-link">Previous</span></li>';
        }

        for (let i = 0; i < Math.ceil(totalElements / pageSize); i++) {
            if (currentPage === i) {
                pages += '<li class="page-item active"><span class="page-link">' + (i + 1) + '</span></li>';
            } else {
                pages += '<li class="page-item"><a class="page-link" onclick="changePage(' + i + ',' + pageSize + ',event)" href="#">' + (i + 1) + '</a></li>';
            }
        }

        if (currentPage < Math.ceil(totalElements / pageSize) - 1) {
            pages += '<li class="page-item"><a class="page-link" onclick="changePage(' + (currentPage + 1) + ',' + pageSize + ',event)" href="#">Next</a></li>';
        } else {
            pages += '<li class="page-item disabled"><span class="page-link">Next</span></li>';
        }

        pageId.append(pages);
    }

    function changePage(page, size, event) {
        event.preventDefault();
        searchCondition(page, size);
    }

    $(document).ready(function () {
        initData(0, 3, {}); // Initialize with the first page and page size of 3
    });

    $(document).on('change', '.status-select', function () {
        var userId = $(this).data('user-id');
        var newStatus = $(this).val();
        console.log(userId + ' ' + newStatus);

        let request = {};
        request.userId = userId;
        request.newStatus = newStatus;

        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/admin/user/updateStatus',
            data: JSON.stringify(request),
            contentType: 'application/json',
            success: function (response) {
                console.log('Update successful');
            },
            error: function (error) {
                console.error('Error updating status:', error.responseText);
            }
        });
    });

    $(document).on('change', '.role-select', function () {
        var userId = $(this).data('user-id');
        var newRole = $(this).val();
        console.log(userId + ' ' + newRole);

        let request = {};
        request.userId = userId;
        request.newRole = newRole;

        $.ajax({
            type: 'POST',
            url: 'http://localhost:8080/admin/user/updateRole',
            data: JSON.stringify(request),
            contentType: 'application/json',
            success: function (response) {
                console.log('Update successful');
            },
            error: function (error) {
                console.error('Error updating status:', error.responseText);
            }
        });
    });

    function searchCondition(page, size) {
        let filter = {};
        filter.username = $("#username").val() || null;
        filter.email = $("#email").val() || null;
        filter.phone = $("#phone").val() || null;
        initData(page, size, filter);
    }
</script>
</body>
</html>